define(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-arcgis","jimu-ui/advanced/data-source-selector"],(function(e,o,t,a,n){return function(e){var o={};function t(a){if(o[a])return o[a].exports;var n=o[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,t),n.l=!0,n.exports}return t.m=e,t.c=o,t.d=function(e,o,a){t.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:a})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,o){if(1&o&&(e=t(e)),8&o)return e;if(4&o&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&o&&"string"!=typeof e)for(var n in e)t.d(a,n,function(o){return e[o]}.bind(null,n));return a},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},t.p="",t(t.s=189)}({0:function(o,t){o.exports=e},1:function(e,t){e.exports=o},189:function(e,o,t){"use strict";var a,n=this&&this.__extends||(a=function(e,o){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o}||function(e,o){for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t])})(e,o)},function(e,o){function t(){this.constructor=e}a(e,o),e.prototype=null===o?Object.create(o):(t.prototype=o.prototype,new t)}),i=this&&this.__makeTemplateObject||function(e,o){return Object.defineProperty?Object.defineProperty(e,"raw",{value:o}):e.raw=o,e};Object.defineProperty(o,"__esModule",{value:!0});var r,s=t(0),u=t(1),c=t(3),l=t(4),p=t(6),d=t(21),m=s.Immutable([p.AllDataSourceTypes.FeatureLayer,p.AllDataSourceTypes.FeatureQuery]),g=function(e){function o(o){var t=e.call(this,o)||this;return t.NoLockTriggerLayerWidgets=["Map"],t.modalStyle={position:"absolute",top:"0",bottom:"0",width:"259px",height:"auto",borderRight:"",borderBottom:"",paddingBottom:"1px"},t.getInitConfig=function(){var e=t.props.messageWidgetId,o=s.getAppStore().getState().appStateInBuilder.appConfig,a=o.widgets[e],n=null;if(t.props.config.useDataSource)n=t.checkAndGetInitUseDataSource(t.props.messageWidgetId,t.props.config.useDataSource);else if(a&&a.useDataSources&&a.useDataSources[0]&&1===a.useDataSources.length){var i=o.dataSources[a.useDataSources[0].dataSourceId];n=!i||i.type!==l.ArcGISDataSourceTypes.WebMap&&i.type!==l.ArcGISDataSourceTypes.WebScene?s.Immutable({dataSourceId:a.useDataSources[0].dataSourceId,mainDataSourceId:a.useDataSources[0].mainDataSourceId,rootDataSourceId:a.useDataSources[0].rootDataSourceId}):null}return{useDataSource:n}},t.checkAndGetInitUseDataSource=function(e,o){var t=s.getAppStore().getState().appStateInBuilder.appConfig,a=t.widgets[e],n=null,i=!1,r=a.useDataSources&&a.useDataSources[0]&&a.useDataSources[0].dataSourceId;if(!r)return null;var u=t.dataSources[r];if(!u||u.type!==l.ArcGISDataSourceTypes.WebMap&&u.type!==l.ArcGISDataSourceTypes.WebScene||(i=!0),i){var c=!1;if(a&&a.useDataSources)for(var p=0;p<a.useDataSources.length;p++)if(a.useDataSources[p].dataSourceId===o.rootDataSourceId){c=!0;break}n=c?o:null}else{c=!1;if(a&&a.useDataSources)for(p=0;p<a.useDataSources.length;p++)if(a.useDataSources[p].dataSourceId===o.dataSourceId){c=!0;break}n=c?o:a&&a.useDataSources&&1===a.useDataSources.length?s.Immutable({dataSourceId:a.useDataSources[0].dataSourceId,rootDataSourceId:a.useDataSources[0].rootDataSourceId}):null}return n},t.handleTriggerLayerChange=function(e){e&&e.length>0?t.handleTriggerLayerSelected(e[0]):t.handleRemoveLayerForTriggerLayer()},t.handleTriggerLayerSelected=function(e){t.props.onSettingChange({actionId:t.props.actionId,config:t.props.config.set("useDataSource",e)})},t.handleRemoveLayerForTriggerLayer=function(){t.props.onSettingChange({actionId:t.props.actionId,config:t.props.config.set("useDataSource",null)})},t.handleIsUseCustomZoomToOption=function(e){!e||t.props.config.zoomToOption&&t.props.config.zoomToOption.scale?t.props.onSettingChange({actionId:t.props.actionId,config:t.props.config.set("isUseCustomZoomToOption",e)}):t.props.onSettingChange({actionId:t.props.actionId,config:t.props.config.set("isUseCustomZoomToOption",e).setIn(["zoomToOption","scale"],5e3)})},t.handleSetCustomZoomScale=function(e){t.props.onSettingChange({actionId:t.props.actionId,config:t.props.config.setIn(["zoomToOption","scale"],e)})},t.getTriggerLayerContent=function(){var e=t.getDsSelectorSourceData(t.props.messageWidgetId,t.props.config.useDataSource);return s.jsx(p.DataSourceSelector,{types:m,useDataSources:e.useDataSources,fromRootDsIds:e.fromRootDsIds,fromDsIds:e.fromDsIds,closeDataSourceListOnChange:!0,disableAddData:!0,hideTypeDropdown:!0,mustUseDataSource:!0,disableRemove:function(){return e.isReadOnly},disableDataSourceList:e.isReadOnly,onChange:t.handleTriggerLayerChange,widgetId:t.props.messageWidgetId,disableDataView:!0,hideDataView:t.checkIsDisableDataView(t.props.messageWidgetId)})},t.getDsRootIdsByWidgetId=function(e){var o,t,a,n,i=null===(t=null===(o=s.getAppStore().getState())||void 0===o?void 0:o.appStateInBuilder)||void 0===t?void 0:t.appConfig,r=null===(a=null==i?void 0:i.widgets)||void 0===a?void 0:a[e],u=[],c=s.DataSourceManager.getInstance();return null===(n=null==r?void 0:r.useDataSources)||void 0===n||n.forEach((function(e){var o=c.getDataSource(e.dataSourceId);(null==o?void 0:o.type)!==l.ArcGISDataSourceTypes.WebMap&&(null==o?void 0:o.type)!==l.ArcGISDataSourceTypes.WebScene||u.push(e.dataSourceId)})),u.length>0?s.Immutable(u):void 0},t.getDsIdsByWidgetId=function(e){var o,t,a,n,i,r=null===(t=null===(o=s.getAppStore().getState())||void 0===o?void 0:o.appStateInBuilder)||void 0===t?void 0:t.appConfig,u=null===(a=null==r?void 0:r.widgets)||void 0===a?void 0:a[e];return s.Immutable(null!==(i=null===(n=null==u?void 0:u.useDataSources)||void 0===n?void 0:n.map((function(e){return e.dataSourceId})))&&void 0!==i?i:[])},t.getDsSelectorSourceData=function(e,o){var a,n,i,r=null===(n=null===(a=s.getAppStore().getState())||void 0===a?void 0:a.appStateInBuilder)||void 0===n?void 0:n.appConfig,u=null===(i=null==r?void 0:r.widgets)||void 0===i?void 0:i[e],c=!1,l=t.getDsRootIdsByWidgetId(e);return l&&0===l.length&&u&&u.useDataSources&&1===u.useDataSources.length&&(c=!0),!l&&u&&u.useDataSources&&1===u.useDataSources.length&&(c=!0),{isReadOnly:c,useDataSources:o&&o.dataSourceId?s.Immutable([o]):s.Immutable([]),fromRootDsIds:l,fromDsIds:l?void 0:t.getDsIdsByWidgetId(e)}},t.checkIsDisableDataView=function(e){var o,a,n,i;if(t.props.messageType===s.MessageType.DataRecordsSelectionChange)return!0;var r=null===(a=null===(o=s.getAppStore().getState())||void 0===o?void 0:o.appStateInBuilder)||void 0===a?void 0:a.appConfig,u=null===(n=null==r?void 0:r.widgets)||void 0===n?void 0:n[e];return!!u&&"Map"===(null===(i=null==u?void 0:u.manifest)||void 0===i?void 0:i.label)},t.modalStyle.borderRight="1px solid black",t.modalStyle.borderBottom="1px solid black",t.state={isShowLayerList:!1},t}return n(o,e),o.prototype.componentDidMount=function(){var e=this.getInitConfig();this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config.set("useDataSource",e.useDataSource)})},o.prototype.getStyle=function(e){return s.css(r||(r=i(["\n      .setting-header {\n        padding: "," "," "," ","\n      }\n\n      .deleteIcon {\n        cursor: pointer;\n        opacity: .8;\n      }\n\n      .deleteIcon:hover {\n        opacity: 1;\n      }\n    "],["\n      .setting-header {\n        padding: "," "," "," ","\n      }\n\n      .deleteIcon {\n        cursor: pointer;\n        opacity: .8;\n      }\n\n      .deleteIcon:hover {\n        opacity: 1;\n      }\n    "])),s.polished.rem(10),s.polished.rem(16),s.polished.rem(0),s.polished.rem(16))},o.prototype.render=function(){var e=this;return s.jsx("div",{css:this.getStyle(this.props.theme)},s.jsx(c.SettingSection,{title:this.props.intl.formatMessage({id:"mapAction_TriggerLayer",defaultMessage:d.default.mapAction_TriggerLayer})},this.getTriggerLayerContent()),s.jsx(c.SettingSection,{title:this.props.intl.formatMessage({id:"mapZoomToAction_ZoomScale",defaultMessage:d.default.mapZoomToAction_ZoomScale})},s.jsx(c.SettingRow,null,s.jsx("div",{className:"d-flex justify-content-between w-100 align-items-center"},s.jsx("div",{className:"align-items-center d-flex"},s.jsx(u.Radio,{style:{cursor:"pointer"},checked:!this.props.config.isUseCustomZoomToOption,onChange:function(){return e.handleIsUseCustomZoomToOption(!1)}}),s.jsx("label",{className:"m-0 ml-2",style:{cursor:"pointer"}},this.props.intl.formatMessage({id:"mapZoomToAction_Automatic",defaultMessage:d.default.mapZoomToAction_Automatic}))))),s.jsx(c.SettingRow,null,s.jsx("div",{className:"d-flex justify-content-between w-100 align-items-center"},s.jsx("div",{className:"align-items-center d-flex"},s.jsx(u.Radio,{style:{cursor:"pointer"},checked:this.props.config.isUseCustomZoomToOption,onChange:function(){return e.handleIsUseCustomZoomToOption(!0)}}),s.jsx("label",{className:"m-0 ml-2",style:{cursor:"pointer"}},this.props.intl.formatMessage({id:"mapZoomToAction_Custom",defaultMessage:d.default.mapZoomToAction_Custom}))))),this.props.config.isUseCustomZoomToOption&&s.jsx(c.SettingRow,null,s.jsx(u.TextInput,{className:"w-100",type:"number",placeholder:this.props.intl.formatMessage({id:"mapZoomToAction_TypeScale",defaultMessage:d.default.mapZoomToAction_TypeScale}),value:this.props.config.zoomToOption&&this.props.config.zoomToOption.scale,onChange:function(o){e.handleSetCustomZoomScale(o.target.value)}}))))},o.defaultProps={config:s.Immutable({useDataSource:null})},o}(s.React.PureComponent);o.default=s.themeUtils.withTheme(g)},21:function(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default={sourceLabel:"Source",sourceDescript:"A web map or web scene, or any combination of the two.",initialMap:"Initial map",initialMapView:"Initial view",selectMap:"Select map",setMapView:"Modify initial view",defaultView:"Default",defaultViewTip:"Initial position of the map inherited from the web map or web scene",customView:"Custom",customViewTip:"Create a new position of the map",customViewSet:"Modify",toolLabel:"Tools",options:"Options",disableScrollZoom:"Disable scroll zooming",disablePopUp:"Disable pop-up",chooseALayer:"Select a layer",dataRelationShip:"Data relationship",mapNone:"none",messageField:"Message field",mapLayout:"Tools layout",mapLayout_LargeAndMedium:"Large and medium size",mapLayout_Small:"Small size",mapAction_TriggerLayer:"Trigger data",mapAction_SetData:"Select data",mapAction_ActionLayer:"Action data",mapAction_Conditions:"Conditions",mapAction_RelateMessage:"Trigger / action connection",mapAction_TriggerLayerField:"Select a trigger field",mapAction_None:"none",mapAction_Equals:"equals",mapAction_ActionLayerField:"Select an action field",mapAction_MoreConditions:"More conditions",mapAction_SetExpression:"Please set your expression first.",mapAction_ChooseLayer:"Select data",mapAction_AutoBind:"Auto bound.",mapAction_NoLayer:"No data.",mapZoomToAction_ZoomScale:"Zoom scale",mapZoomToAction_Automatic:"Automatic",mapZoomToAction_Custom:"Custom",mapZoomToAction_TypeScale:"Type a scale"}},3:function(e,o){e.exports=t},4:function(e,o){e.exports=a},6:function(e,o){e.exports=n}})}));