define(["jimu-core","jimu-ui","jimu-ui/advanced/rich-text-editor"],(function(e,t,n){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=492)}({0:function(t,n){t.exports=e},1:function(e,n){e.exports=t},114:function(e,t,n){"use strict";var r=this;Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(1);t.DATA_SOURCE_ID_REGEXP=/data-dsid=\"(((?![\=|\>|\"]).)*)[\"\>|"\s)]/gm,t.getDataSourceIds=function(e){return void 0===e&&(e=o.Immutable([])),e.map((function(e){return e.dataSourceId}))},t.getTextFormats=function(e){var t=e&&e.typography.fontFamilyBase||"Avenir Next",n=e&&e.typography.lineHeights.medium||"1.5",r=e&&e.body.color,o=e&&e.typography.fontSizeBase||"14px";return{font:t,linespace:n,color:r,size:o=a.styleUtils.remToPixel(o)}},t.replaceUseDataSourcesFields=function(e,n){if(e)return e.map((function(e){var r=e.dataSourceId,o=n?t.getUseDataSourceById(n,r):null;if(!o)return e.set("fields",[]);var a=o.fields;return e.set("fields",a)}))},t.getUseDataSourceById=function(e,t){return e.filter((function(e){return e.dataSourceId===t}))[0]},t.getUseDataSourceIds=function(e){for(var n,r=t.DATA_SOURCE_ID_REGEXP,o=[];null!==(n=r.exec(e));){var a=n[1];a.indexOf(",")>0?(a=a.split(","),o=o.concat(a)):o.push(a)}return o},t.getInvalidDataSourceIds=function(e,n){var o=r.getUseDataSourceIds(e);if(o&&o.length){var a=t.getDataSourceIds(n),i=o.filter((function(e){return a.indexOf(e)<0}));return i.length?i:void 0}},t.getExpressionParts=function(e){var t=[];for(var n in e){var r=e[n],o=r&&r.parts;o&&(t=t.concat(o))}return t},t.BLANK_CHARATER="\ufeff";var i=document.createElement("div");t.operatePlaceholder=function(e,t,n){var r=a.richTextUtils.isBlankRichText(e)&&t;return void 0!==n?!n&&r:r},t.sanitizeHTML=function(e){return e?a.sanitizer.sanitize(e):e},t.getCleanStyle=function(e,n){if(n){var r,o=e?e.getText():(r=n,i.innerHTML=r,i.textContent);return null==n?void 0:n.replace(null==o?void 0:o.trim(),t.BLANK_CHARATER)}},t.getDefaultValue=function(e,n,r,o){var a=n;e?t.operatePlaceholder(n,r)&&(a=t.getCleanStyle(o,r)):a=t.operatePlaceholder(n,r)?r:n;return t.sanitizeHTML(a)},t.setSecurityContent=function(e,n){n&&(e=t.sanitizeHTML(e),n.setContents(n.clipboard.convert(e),"silent"))}},115:function(e,t,n){"use strict";var r=this;Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(1);t.getTextFormats=function(e){var t=e&&e.typography.fontFamilyBase||"Avenir Next",n=e&&e.typography.lineHeights.medium||"1.5",r=e&&e.body.color,o=e&&e.typography.fontSizeBase||"14px";return{font:t,linespace:n,color:r,size:o=a.styleUtils.remToPixel(o)}},t.mixinFormats=function(e,t){void 0===t&&(t={});var n=r.getTextFormats(e);return t=o.lodash.assign({},n,t)}},42:function(e,t){e.exports=n},492:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(493),o=n(114);t.default={Editor:r.Editor,builderUtils:o}},493:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),i=n(494),u=n(495);t.Editor=function(e){var t=e.value,n=e.widgetId,c=e.useDataSources,l=e.onChange,s=e.onCreate,d=e.onDestory,f=o(e,["value","widgetId","useDataSources","onChange","onCreate","onDestory"]),p=u.useEditorCycle(s,d),v=u.usePlugin(n,c),g=u.useInvalidStyle(t,c);return a.jsx(i.EditorPlaceholder,r({editorRef:p,css:g,value:t,modules:u.TEXT_MODULES,plugin:v,onChange:l},f))}},494:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),i=n(1),u=a.React.useEffect,c=a.React.useRef,l=a.React.useCallback,s=a.React.useState,d=n(42),f=n(114);t.EditorPlaceholder=function(e){var t=e.editorRef,n=e.value,p=e.placeholder,v=e.enabled,g=e.onChange,h=o(e,["editorRef","value","placeholder","enabled","onChange"]),y=i.hooks.useForwardRef(t),b=y[0],m=y[1],x=s(n),O=x[0],S=x[1],P=s(p),_=P[0],E=P[1],j=function(e,t,n,r){var o=c({enabled:e,value:t,placeholder:n,onChange:r});return u((function(){o.current={enabled:e,value:t,placeholder:n,onChange:r}}),[e,t,n,r]),o}(v,O,_,g),C=l((function(e,t,n){if("silent"!==n){var r=j.current,o=r.enabled,a=r.value,i=r.placeholder;f.operatePlaceholder(a,i,o)?E(e):S(e)}}),[]),R=c(v);return u((function(){var e=j.current,t=e.value,n=e.placeholder,r=e.onChange,o=b.current;if(v){if(!R.current){var a=b.current;if(f.operatePlaceholder(t,n)){var i=f.getCleanStyle(a,n);f.setSecurityContent(i,a),a.focus()}}}else R.current&&(f.operatePlaceholder(t,n)&&f.setSecurityContent(n,o),null==r||r(t,n));R.current=v}),[v]),i.hooks.useUnmount((function(){var e=j.current,t=e.value,n=e.placeholder,r=e.onChange;null==r||r(t,n)})),a.React.createElement(d.RichTextEditor,r({enabled:v,editorRef:m,onChange:C,defaultValue:f.getDefaultValue(v,O,_,b.current)},h))}},495:function(e,t,n){"use strict";var r=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};Object.defineProperty(t,"__esModule",{value:!0});var o,a,i,u=n(0),c=n(114),l=n(496),s=u.React.useMemo,d=u.React.useCallback,f=u.css(o||(o=r(["\n  opacity: 0.5;\n  background: red;\n  outline: 1px solid white;\n"],["\n  opacity: 0.5;\n  background: red;\n  outline: 1px solid white;\n"])));t.TEXT_MODULES={toolbar:!1,autoformat:{link:{trigger:/[\s]/,find:/https?:\/\/[\S]+|(www\.[\S]+)/gi,transform:function(e,t){return t?"http://"+e:e},format:"link"}},clipboard:{matchers:[["img",function(){return{ops:[],length:0}}]]}},t.usePlugin=function(e,t){return s((function(){return function(n){var r=n.editor;return u.React.createElement(l.TextPlugins,{editor:r,widgetId:e,useDataSources:t})}}),[t,e])},t.useInvalidStyle=function(e,t){return s((function(){var n,o=c.getInvalidDataSourceIds(e,t);return o&&(n=o.map((function(e){return u.css(a||(a=r(['\n          exp[data-dsid*="','"] {\n           ',"\n          }\n        "],['\n          exp[data-dsid*="','"] {\n           ',"\n          }\n        "])),e,f)}))),u.css(i||(i=r(["",""],["",""])),n)}),[e,t])},t.useEditorCycle=function(e,t){return d((function(n){return n?null==e?void 0:e(n):null==t?void 0:t()}),[e,t])}},496:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(42),a=n(115),i=n(1),u=r.React.useContext,c=r.React.useCallback,l=r.React.useMemo;t.translate=function(e,t){return t?t.formatMessage({id:e,defaultMessage:i.defaultMessages[e]}):""},t._TextPlugins=function(e){var n=u(r.ThemeContext),i=e.editor,s=e.showExpression,d=e.useDataSources,f=e.intl,p=e.widgetId,v=c((function(e){return void 0===e&&(e={}),a.mixinFormats(n,e)}),[n]),g=l((function(){return{title:t.translate("dynamicContent",f),onClose:function(){return r.getAppStore().dispatch(r.appActions.widgetStatePropChange(p,"showExpression",!1))}}}),[p,f]);return r.React.createElement(r.React.Fragment,null,r.React.createElement(o.Bubble,{editor:i,mixFormats:v,source:"user"}),r.React.createElement(o.Expression,{source:"user",editor:i,open:s,useDataSources:d,header:g,widgetId:p}))};t.TextPlugins=r.ReactRedux.connect((function(e,t){var n;return{showExpression:!!(null===(n=e.widgetsState[t.widgetId])||void 0===n?void 0:n.showExpression)}}))(r.injectIntl(t._TextPlugins))}})}));