define(["jimu-core","jimu-ui"],(function(e,t){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=489)}({0:function(t,n){t.exports=e},1:function(e,n){e.exports=t},489:function(e,t,n){"use strict";var i=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};Object.defineProperty(t,"__esModule",{value:!0});var o,r=n(0),a=n(490),s=n(491),u=r.React.useCallback,l=n(1),c=r.ReactRedux.useSelector,d=r.ReactRedux.useDispatch,p=r.React.useState,f=r.React.useMemo,h=r.React.useEffect,v=r.React.useRef;!function(e){e[e.None=0]="None",e[e.Main=1]="Main",e[e.Sub=2]="Sub"}(o||(o={}));var g,w=function(e,t){return e===s.default.placeholder&&(e=function(e,t){return t?t.formatMessage({id:e,defaultMessage:s.default[e]}):""}("placeholder",t)),e};t.default=function(e){var t,n=e.builderSupportModules,s=e.id,x=e.intl,m=e.useDataSources,b=e.repeatedDataSource,y=e.useDataSourcesEnabled,S=e.isInlineEditing,j=e.config,O=d(),R=c((function(e){return e.appContext.isInBuilder})),D=c((function(e){return e.appRuntimeInfo.appMode})),M=null==n?void 0:n.jimuForBuilderLib.getAppConfigAction,E=null==n?void 0:n.widgetModules.Editor,P=null==n?void 0:n.widgetModules.builderUtils,_=l.hooks.useWidgetSelected(s),I=null===(t=null==j?void 0:j.style)||void 0===t?void 0:t.wrap,U=null==j?void 0:j.text,z=null==j?void 0:j.tooltip,C=w(null==j?void 0:j.placeholder,x),k=y?m:void 0,A=p(2),T=A[0],N=A[1],W=p(null),B=W[0],F=W[1];h((function(){var e;e=b?0===b.recordIndex?o.Main:o.Sub:o.None,N(e)}),[b]),h((function(){D===r.AppMode.Run&&O(r.appActions.setWidgetIsInlineEditingState(s,!1))}),[D]);var H=l.hooks.useRefValue(_);h((function(){H.current&&O(r.appActions.setWidgetIsInlineEditingState(s,!0))}),[]),h((function(){S||O(r.appActions.widgetStatePropChange(s,"showExpression",!1))}),[S]);var L=f((function(){return _&&T!==o.Sub}),[T,_]),V=f((function(){return r.css(g||(g=i(["\n      display: flex;\n      /* if editable, make the editor wrea scrollable, otherwise, set overflow as hidden*/\n      overflow: ",";\n      /* Ensure that the cursor can be displayed when automatic width of layout */\n      min-width: 12px;\n    "],["\n      display: flex;\n      /* if editable, make the editor wrea scrollable, otherwise, set overflow as hidden*/\n      overflow: ",";\n      /* Ensure that the cursor can be displayed when automatic width of layout */\n      min-width: 12px;\n    "])),L?"auto":"hidden")}),[L]),q=v(!1);h((function(){return function(){q.current=!0}}),[]),l.hooks.useUpdateEffect((function(){var e=l.richTextUtils.getAllExpressions(U);e=(e=e||r.Immutable({})).merge(z?{tooltip:z}:{}),F(e)}),[U,z]);var G=u((function(e,t){q.current||R&&M().editWidget({id:s,config:j.set("text",e).set("placeholder",t)}).exec()}),[j]);return l.hooks.useUpdateEffect((function(){if(!q.current&&R&&k){var e=r.expressionUtils.whetherHasFieldsInUseDataSources(k),t=P.getExpressionParts(B);if(e||(null==t?void 0:t.length)){var n=r.expressionUtils.getUseDataSourceFromExpParts(t,k),i=r.expressionUtils.getUseDataSourcesWithoutFields(k);n=r.expressionUtils.mergeUseDataSources(i,n),M().editWidget({id:s,useDataSources:n}).exec()}}}),[B]),r.React.createElement("div",{"data-testid":"text-widget",css:V,className:r.classNames("widget-text jimu-widget p-1")},L&&r.React.createElement(E,{widgetId:s,nowrap:!I,useDataSources:k,enabled:!!S,onCreate:function(e){O(r.appActions.widgetMutableStatePropChange(s,"editor",e))},onDestory:function(){O(r.appActions.widgetMutableStatePropChange(s,"editor",null))},onChange:G,placeholder:C,preserveWhitespace:!0,value:U}),!L&&r.React.createElement(a.Displayer,{value:U,tooltip:z,wrap:I,preview:R&&D===r.AppMode.Run,placeholder:C,useDataSources:k,widgetId:s,repeatedDataSource:b}))}},490:function(e,t,n){"use strict";var i=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},r=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(n[i[o]]=e[i[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0});var a,s,u,l=n(0),c=n(1),d=n(1),p=l.React.useState,f=l.React.useCallback,h=l.React.useEffect,v=l.React.useRef,g=n(75),w=l.css(a||(a=i(["\n .tooltip {\n    max-width: 360px;\n    max-height: 240px;\n    overflow-x: hidden;\n    overflow-y: auto;\n    padding: 5px;\n    text-align: left;\n  }\n"],["\n .tooltip {\n    max-width: 360px;\n    max-height: 240px;\n    overflow-x: hidden;\n    overflow-y: auto;\n    padding: 5px;\n    text-align: left;\n  }\n"])));t.Displayer=function(e){var t=e.value,n=e.placeholder,a=e.repeatedDataSource,x=e.useDataSources,m=e.widgetId,b=e.wrap,y=e.tooltip,S=e.preview,j=r(e,["value","placeholder","repeatedDataSource","useDataSources","widgetId","wrap","tooltip","preview"]),O=l.expressionUtils.isSingleStringExpression(y),R=p(""),D=R[0],M=R[1],E=p(-1),P=E[0],_=E[1],I=p(0),U=I[0],z=I[1],C=p(""),k=C[0],A=C[1],T=p(!1),N=T[0],W=T[1],B=p(!1),F=B[0],H=B[1],L=v();h((function(){if(y&&O){var e=l.expressionUtils.getSingleStringExpressionText(y);M(e)}}),[y,O]);var V=!!P&&U>P;h((function(){W(V&&F)}),[V,F]),h((function(){var e=L.current;if(e){var t=e.textContent;A(t)}}),[N]);var q=f((function(e,t){_(t)}),[]),G=f((function(e,t){z(t)}),[]),J=v(),K=function(){J.current&&(clearTimeout(J.current),J.current=null),H(!0)};return l.jsx("div",o({css:function(e){var t=l.css(s||(s=i(["\n      .rich-displayer {\n        white-space: nowrap !important;\n      }\n   "],["\n      .rich-displayer {\n        white-space: nowrap !important;\n      }\n   "])));return l.css(u||(u=i(["\n      width: 100%;\n      height: 100%;\n      position: relative;\n      overflow-y: hidden;\n      .fit-content {\n        width: 100%;\n        height: fit-content;\n        .rich-displayer {\n          width: 100%;\n          height: fit-content;\n        }\n      }\n\n      ",";\n      .more {\n        padding: 0 !important;\n        position: absolute;\n        right: 0;\n        bottom: 0;\n        .icon-btn-sizer {\n          min-height: unset;\n          min-width: unset;\n          width: 16px;\n          height: 8px;\n        }\n      }\n    "],["\n      width: 100%;\n      height: 100%;\n      position: relative;\n      overflow-y: hidden;\n      .fit-content {\n        width: 100%;\n        height: fit-content;\n        .rich-displayer {\n          width: 100%;\n          height: fit-content;\n        }\n      }\n\n      ",";\n      .more {\n        padding: 0 !important;\n        position: absolute;\n        right: 0;\n        bottom: 0;\n        .icon-btn-sizer {\n          min-height: unset;\n          min-width: unset;\n          width: 16px;\n          height: 8px;\n        }\n      }\n    "])),!e&&t)}(b)},j,{onMouseOver:K,onMouseLeave:function(){J.current=setTimeout((function(){H(!1),J.current=null}),500)},title:D}),l.jsx(l.ReactResizeDetector,{handleHeight:!0,onResize:q}),l.jsx("div",{className:"fit-content"},l.jsx(l.ReactResizeDetector,{handleHeight:!0,onResize:G}),l.jsx(c.RichTextDisplayer,{ref:L,widgetId:m,repeatedDataSource:a,useDataSources:x,preview:S,value:t,placeholder:n})),N&&l.jsx(d.Tooltip,{css:w,title:k,showArrow:!0,interactive:!0,leaveDelay:500},l.jsx(d.Button,{className:"more",type:"default",icon:!0,onMouseOver:K},l.jsx(d.Icon,{size:12,icon:g}))),!O&&y&&l.jsx(l.ExpressionResolverComponent,{useDataSources:x,expression:y,widgetId:m,onChange:function(e){(null==e?void 0:e.isSuccessful)&&M(e.value)}}))}},491:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={_widgetLabel:"Text",placeholder:"Double click to edit text"}},75:function(e,t){e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><g fill-rule="nonzero" fill="none"><path d="M13 7.5a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zm-6.5 0a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zM0 7.5a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0z" fill="#000"></path><path d="M0 0h16v16H0z"></path></g></svg>'}})}));