define(["jimu-core","jimu-ui"],(function(e,t){return function(e){var t={};function o(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=285)}({0:function(t,o){t.exports=e},1:function(e,o){e.exports=t},285:function(e,t,o){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var i in t=arguments[o])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var p,u=o(0),l=o(1),a=o(83),c=o(286),f=o(287),g=o(84),d=o(1);!function(e){e[e.None=0]="None",e[e.Main=1]="Main",e[e.Sub=2]="Sub"}(p||(p={}));var y,h=function(e){function t(t){var o=e.call(this,t)||this;return o.repeat=0,o.getTextFromProps=function(){var e,t,n,i;return"string"==typeof(null===(t=null===(e=o.props.config)||void 0===e?void 0:e.functionConfig)||void 0===t?void 0:t.text)?null===(i=null===(n=o.props.config)||void 0===n?void 0:n.functionConfig)||void 0===i?void 0:i.text:o.props.intl.formatMessage({id:"variableButton",defaultMessage:d.defaultMessages.variableButton})},o.setRepeatType=function(){var e,t=o.props.repeatedDataSource;e=t?0===t.recordIndex?p.Main:p.Sub:p.None,o.repeat=e},o.getTipExpression=function(){var e,t;return o.props.config&&o.props.config.functionConfig&&o.props.config.functionConfig.toolTipExpression&&o.props.config.functionConfig.toolTipExpression||u.Immutable({name:"",parts:[{type:u.ExpressionPartType.String,exp:'"'+((null===(t=null===(e=o.props.config)||void 0===e?void 0:e.functionConfig)||void 0===t?void 0:t.toolTip)||"")+'"'}]})},o.getTextExpression=function(){var e,t;return o.props.config&&o.props.config.functionConfig&&o.props.config.functionConfig.textExpression&&o.props.config.functionConfig.textExpression||u.Immutable({name:"",parts:[{type:u.ExpressionPartType.String,exp:'"'+((null===(t=null===(e=o.props.config)||void 0===e?void 0:e.functionConfig)||void 0===t?void 0:t.text)||o.getTextFromProps())+'"'}]})},o.getUrlExpression=function(){return o.props.config&&o.props.config.functionConfig&&o.props.config.functionConfig.linkParam&&o.props.config.functionConfig.linkParam&&o.props.config.functionConfig.linkParam.expression||null},o.onTextExpResolveChange=function(e){if(e.isSuccessful)o.setState({text:e.value});else{var t="";e.value===u.ExpressionResolverErrorCode.Failed&&(t=o.state.textExpression&&o.state.textExpression.name),o.setState({text:t})}},o.onTipExpResolveChange=function(e){if(e.isSuccessful)o.setState({toolTip:e.value});else{var t="";e.value===u.ExpressionResolverErrorCode.Failed&&(t=o.state.tipExpression&&o.state.tipExpression.name),o.setState({toolTip:t})}},o.onUrlExpResolveChange=function(e){if(e.isSuccessful)o.setState({url:e.value});else{var t="";e.value===u.ExpressionResolverErrorCode.Failed&&(t=o.state.urlExpression&&o.state.urlExpression.name),o.setState({url:t})}},o.showQuickStylePanel=function(){if(!window.jimuConfig.isInBuilder)return!1;var e=o.repeat,t=o.props.active;return o.props.showQuickStyle&&t&&e!==p.Sub},o.getWhetherUseQuickStyle=function(e){return!!(e&&e.styleConfig&&e.styleConfig.themeStyle&&e.styleConfig.themeStyle.quickStyleType)},o.getIconStyle=function(e,t){var o=e||{},n=t||{};return u.css(y||(y=s(["\n      & img, & svg{\n        color: ",";\n        fill: ",";\n        width: ","",";\n        height: ","",";\n      }\n      &:hover{\n        img, svg{\n          color: ",";\n          fill: ",";\n          width: ","",";\n          height: ","",";\n        }\n      }\n    "],["\n      & img, & svg{\n        color: ",";\n        fill: ",";\n        width: ","",";\n        height: ","",";\n      }\n      &:hover{\n        img, svg{\n          color: ",";\n          fill: ",";\n          width: ","",";\n          height: ","",";\n        }\n      }\n    "])),o.color,o.color,o.size,l.UnitTypes.PIXEL,o.size,l.UnitTypes.PIXEL,n.color,n.color,n.size,l.UnitTypes.PIXEL,n.size,l.UnitTypes.PIXEL)},o.removeUndefinedStyle=function(e){if(!e)return e;var t={};return Object.keys(e).forEach((function(o){("string"==typeof e[o]&&e[o].indexOf("undefined")<0||"number"==typeof e[o])&&(t[o]=e[o])})),t},o.getLinkComponent=function(){var e,t,n=o.props.config,i=n.functionConfig.linkParam,s=o.state.text,p=o.state.toolTip;if(n.styleConfig&&n.styleConfig.customStyle){var c=n.styleConfig.customStyle.regular,f=n.styleConfig.customStyle.hover;if(n.styleConfig.useCustom){var g=l.styleUtils.toCSSStyle(c&&c.without("iconProps").asMutable({deep:!0})),d=l.styleUtils.toCSSStyle(f&&f.without("iconProps").asMutable({deep:!0}));if(o.props.active&&o.props.appMode!==u.AppMode.Run){var y=u.getAppStore().getState().widgetsState[o.props.id]||u.Immutable({});e={style:y.isConfiguringHover?r(r({},o.removeUndefinedStyle(g)),o.removeUndefinedStyle(d)):g,hoverStyle:d},t=o.getIconStyle(y.isConfiguringHover?r(r({},null==c?void 0:c.iconProps),null==f?void 0:f.iconProps):null==c?void 0:c.iconProps,null==f?void 0:f.iconProps)}else e={style:g,hoverStyle:d},t=o.getIconStyle(c&&c.iconProps,f&&f.iconProps)}}var h,v,m,S=o.getWhetherUseQuickStyle(n)?{type:n.styleConfig.themeStyle.quickStyleType}:null;i&&i.linkType&&(v=i.openType,m={linkType:i.linkType},i.linkType===u.LinkType.WebAddress?m.value=o.state.url:(m.value=i.value,h=o.props.queryObject));var C=n.functionConfig.icon;return u.jsx(l.Link,{to:m,target:v,queryObject:h,title:p,className:"widget-button-link text-truncate w-100 h-100 p-0 d-flex align-items-center justify-content-center",customStyle:e,themeStyle:S,css:t},C&&(!C.position||C.position===a.IconPosition.Left)&&u.jsx(l.Icon,{icon:C.data,className:u.classNames({"mr-2 ml-0":!!s,"mx-0":!s})}),s,C&&C.position&&C.position===a.IconPosition.Right&&u.jsx(l.Icon,{icon:C.data,className:u.classNames({"ml-2 mr-0":!!s,"mx-0":!s})}))},o.onQuickStyleChange=function(e){var t=o.props.config,n=o.props.id,i=o.props.builderSupportModules,s=i&&i.jimuForBuilderLib.getAppConfigAction;s&&(t=(t=(t=(t=t.setIn(["styleConfig","useCustom"],!1)).setIn(["styleConfig","themeStyle","quickStyleType"],e)).setIn(["styleConfig","customStyle","regular"],{iconProps:g.getIconPropsFromTheme(!0,e,o.props.theme)})).setIn(["styleConfig","customStyle","hover"],{iconProps:g.getIconPropsFromTheme(!1,e,o.props.theme)}),s().editWidgetProperty(n,"config",t).exec())},o.onClick=function(e){e.exbEventType="linkClick"},o.onQuickStyleClose=function(){return o.props.dispatch(u.appActions.widgetStatePropChange(o.props.id,"showQuickStyle",!1))},o.getQuickStyleComponent=function(){var e,t,n,i,s,r=o.props.builderSupportModules&&o.props.builderSupportModules.widgetModules&&o.props.builderSupportModules.widgetModules.QuickStyle;return r?u.jsx(r,{onChange:o.onQuickStyleChange,reference:o.domNode&&o.domNode.current,onClose:o.onQuickStyleClose,selectedType:!(null===(t=null===(e=o.props.config)||void 0===e?void 0:e.styleConfig)||void 0===t?void 0:t.useCustom)&&(null===(s=null===(i=null===(n=o.props.config)||void 0===n?void 0:n.styleConfig)||void 0===i?void 0:i.themeStyle)||void 0===s?void 0:s.quickStyleType)}):null},o.state={text:o.getTextFromProps(),toolTip:o.props.config&&o.props.config.functionConfig&&o.props.config.functionConfig.toolTip||"",url:o.props.config&&o.props.config.functionConfig&&o.props.config.functionConfig.linkParam&&o.props.config.functionConfig.linkParam.value||"",textExpression:o.props.useDataSourcesEnabled&&o.getTextExpression(),tipExpression:o.props.useDataSourcesEnabled&&o.getTipExpression(),urlExpression:o.props.useDataSourcesEnabled&&o.getUrlExpression()},o.domNode=u.React.createRef(),o}return i(t,e),t.prototype.componentDidMount=function(){this.setRepeatType(),window.jimuConfig.isInBuilder&&this.props.dispatch(u.appActions.widgetStatePropChange(this.props.id,"showQuickStyle",!0))},t.prototype.componentDidUpdate=function(e,t){this.props.useDataSourcesEnabled||this.props.config===e.config&&!e.useDataSourcesEnabled||this.setState({text:this.getTextFromProps(),toolTip:this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.toolTip,url:this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.linkParam&&this.props.config.functionConfig.linkParam.value}),!this.props.useDataSourcesEnabled||this.props.config===e.config&&e.useDataSourcesEnabled||this.setState({textExpression:this.getTextExpression(),tipExpression:this.getTipExpression(),urlExpression:this.getUrlExpression()}),(window.jimuConfig.isInBuilder&&this.props.appMode!==e.appMode&&this.props.appMode===u.AppMode.Run||this.props.active!==e.active)&&this.props.dispatch(u.appActions.widgetStatePropChange(this.props.id,"showQuickStyle",!1))},t.prototype.render=function(){var e=this.props.useDataSourcesEnabled,t=this.showQuickStylePanel(),o=this.getLinkComponent(),n=this.getQuickStyleComponent();return u.jsx("div",{className:"jimu-widget widget-button w-100 h-100",css:c.getStyle(this.props.theme),ref:this.domNode,onClick:this.onClick,onTouchEnd:this.onClick},o,t&&n,u.jsx("div",{style:{display:"none"}},e&&u.jsx("div",null,u.jsx(u.ExpressionResolverComponent,{useDataSources:this.props.useDataSources,expression:this.state.textExpression,onChange:this.onTextExpResolveChange,widgetId:this.props.id}),u.jsx(u.ExpressionResolverComponent,{useDataSources:this.props.useDataSources,expression:this.state.tipExpression,onChange:this.onTipExpResolveChange,widgetId:this.props.id}),u.jsx(u.ExpressionResolverComponent,{useDataSources:this.props.useDataSources,expression:this.state.urlExpression,onChange:this.onUrlExpResolveChange,widgetId:this.props.id}))))},t.mapExtraStateProps=function(e,t){var o=!1,n=e.appRuntimeInfo.selection;if(n&&e.appConfig.layouts[n.layoutId]){var i=e.appConfig.layouts[n.layoutId].content[n.layoutItemId];o=i&&i.widgetId===t.id}return{active:e.appContext.isInBuilder&&o,showQuickStyle:!!(e.widgetsState[t.id]||u.Immutable({})).showQuickStyle,appMode:e.appRuntimeInfo.appMode}},t.versionManager=f.versionManager,t}(u.BaseWidget);t.default=h},286:function(e,t,o){"use strict";var n=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};Object.defineProperty(t,"__esModule",{value:!0});var i,s=o(0);t.getStyle=function(e){return s.css(i||(i=n(["\n    &>a {\n      display: flex !important;\n      justify-content: center;\n    }\n\n  "],["\n    &>a {\n      display: flex !important;\n      justify-content: center;\n    }\n\n  "])))}},287:function(e,t,o){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});Object.defineProperty(t,"__esModule",{value:!0});var s=o(0),r=o(1),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.versions=[{version:"1.0.0",description:"The first release.",upgrader:function(e){var t=e;return t.getIn(["styleConfig","name"])&&(t=t.set("styleConfig",t.styleConfig.without("name"))),t.getIn(["styleConfig","customStyle"])&&(t=t.set("styleConfig",t.styleConfig.without("customStyle"))),t.getIn(["styleConfig","themeStyle","quickStyleType"])&&(t=t.setIn(["styleConfig","themeStyle"],{quickStyleType:t.styleConfig.themeStyle.quickStyleType})),t=t.setIn(["styleConfig","useCustom"],!1)}},{version:"1.1.0",description:"1.1.0",upgrader:function(e){var t=e;return t.getIn(["styleConfig","useCustom"])&&t.getIn(["styleConfig","customStyle","regular","border","width"])&&(t=t.setIn(["styleConfig","customStyle","regular","border","width"],r.utils.stringOfLinearUnit(t.getIn(["styleConfig","customStyle","regular","border","width"])))),t.getIn(["styleConfig","useCustom"])&&t.getIn(["styleConfig","customStyle","hover","border","width"])&&(t=t.setIn(["styleConfig","customStyle","hover","border","width"],r.utils.stringOfLinearUnit(t.getIn(["styleConfig","customStyle","hover","border","width"])))),t}}],t}return i(t,e),t}(s.BaseVersionManager);t.versionManager=new p},83:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Left="LEFT",e.Right="RIGHT"}(t.IconPosition||(t.IconPosition={}))},84:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(0),i=o(1);t.getIconPropsFromTheme=function(e,t,o){var s=e?"default":"hover",r=n.Immutable(o),p=r.getIn(["components","button","variants",t,s,"color"]),u=r.getIn(["components","button","sizes","default","fontSize"]);return{color:p,size:parseFloat(i.styleUtils.remToPixel(u))}}}})}));