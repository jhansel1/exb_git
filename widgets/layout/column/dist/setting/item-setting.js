define(["jimu-core","jimu-ui","jimu-layouts/layout-runtime","jimu-ui/advanced/setting-components","jimu-ui/advanced/style-setting-components","jimu-layouts/layout-builder"],(function(t,e,o,n,i,a){return function(t){var e={};function o(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}return o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=537)}({0:function(e,o){e.exports=t},1:function(t,o){t.exports=e},2:function(t,e){t.exports=o},3:function(t,e){t.exports=n},537:function(t,e,o){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),a=this&&this.__makeTemplateObject||function(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t};Object.defineProperty(e,"__esModule",{value:!0});var s,r=o(0),u=o(3),l=o(1),p=o(2),d=o(8),h=o(7),g={width:"7.5rem"},c=[p.LayoutItemSizeModes.Auto,p.LayoutItemSizeModes.Custom,p.LayoutItemSizeModes.Stretch],y=[l.UnitTypes.PIXEL,l.UnitTypes.PERCENTAGE],m=[l.UnitTypes.PIXEL],f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.updateBBox=function(t,o){var n,i,a=e.props.layoutItem.bbox,s=o.distance,r=o.unit,u=a[t],d=e.getSizeOfContainer(),h=s.toFixed(2);if(p.utils.isPercentage(u)&&r===l.UnitTypes.PIXEL?d&&(i=h="left"===t||"right"===t||"width"===t?Math.round(parseFloat(u)*d.width/100):Math.round(parseFloat(u)*d.height/100)):p.utils.isPercentage(u)||r!==l.UnitTypes.PERCENTAGE||(d&&(h="left"===t||"right"===t||"width"===t?(100*parseFloat(u)/d.width).toFixed(4):(100*parseFloat(u)/d.height).toFixed(4)),i=parseFloat(u)),i||r!==l.UnitTypes.PERCENTAGE)i||r!==l.UnitTypes.PIXEL||(i=s);else{var g="width"===t?d.width:d.height;i=Math.round(s*g/100)}if(a=a.set(t,r===l.UnitTypes.PERCENTAGE?h+"%":h+"px"),"ratio"===(null===(n=e.props.layoutItem.setting)||void 0===n?void 0:n.heightMode)){var c=e.props.layoutItem.setting.aspectRatio;if("width"===t){var y=i*c;if(p.utils.isPercentage(a.height)){var m=(100*y/d.height).toFixed(4);a=a.set("height",m+"%")}else a=a.set("height",Math.round(y)+"px")}else{var f=i/c;if(p.utils.isPercentage(a.width)){var I=(100*f/d.width).toFixed(4);a=a.set("width",I+"%")}else a=a.set("width",Math.round(f)+"px")}}e.props.onPosChange({layoutId:e.props.layoutId,layoutItemId:e.props.layoutItem.id},a)},e.updateAspectSetting=function(t){var o=e.props.layoutItem.setting||r.Immutable({});if(o=o.set("heightMode",t),"ratio"===t){var n=e.getSizeOfItem();n&&(o=o.set("aspectRatio",Number((n.height/n.width).toFixed(2))))}else{var i=e.props.layoutItem.bbox,a=e.getSizeOfItem();if(p.utils.isPercentage(i.width)){var s=e.getSizeOfContainer();i=i.set("width",(100*a.width/s.width).toFixed(4)+"%")}else i=i.set("width",Math.round(a.width)+"px");i=i.set("height",Math.round(a.height)+"px"),e.props.onPosChange({layoutId:e.props.layoutId,layoutItemId:e.props.layoutItem.id},i)}e.props.onSettingChange({layoutId:e.props.layoutId,layoutItemId:e.props.layoutItem.id},o)},e.updateAlignSelf=function(t){var o=e.props.layoutItem.setting||r.Immutable({});o=o.setIn(["style","alignSelf"],t.target.value),e.props.onSettingChange({layoutId:e.props.layoutId,layoutItemId:e.props.layoutItem.id},o)},e.updateHeightMode=function(t){var o=e.props.layoutItem.setting||r.Immutable({});e.props.onSettingChange({layoutId:e.props.layoutId,layoutItemId:e.props.layoutItem.id},o.setIn(["autoProps","height"],t))},e.updateWidthMode=function(t){var o=e.props.layoutItem.setting||r.Immutable({});e.props.onSettingChange({layoutId:e.props.layoutId,layoutItemId:e.props.layoutItem.id},o.setIn(["autoProps","width"],t))},e.updateAspectRatio=function(t){var o=e.props.layoutItem.setting||r.Immutable({});o=o.set("aspectRatio",t),e.props.onSettingChange({layoutId:e.props.layoutId,layoutItemId:e.props.layoutItem.id},o)},e.formatMessage=function(t){return e.props.formatMessage(t)},e}return i(e,t),e.prototype.getSizeOfContainer=function(){var t=this.querySelector('div.flexbox-layout[data-layoutid="'+this.props.layoutId+'"]');return t?t.getBoundingClientRect():null},e.prototype.getSizeOfItem=function(){var t=this.props,e=t.layoutId,o=t.layoutItem,n=this.querySelector('div.exb-rnd[data-layoutid="'+e+'"][data-layoutitemid="'+o.id+'"]');return n?n.getBoundingClientRect():null},e.prototype.querySelector=function(t){var e=document.querySelector('iframe[name="'+r.APP_FRAME_NAME_IN_BUILDER+'"]');return e?(e.contentDocument||e.contentWindow.document).querySelector(t):null},e.prototype.getStyle=function(){return r.css(s||(s=a(["\n      .rotation-setting, .rotation-setting input {\n        height: 26px;\n      }\n\n      .ratio-value {\n        font-size: 12px;\n      }\n\n      .align-select {\n        .dropdown-button, .dropdown-button:hover {\n          height: 26px;\n        }\n      }\n    "],["\n      .rotation-setting, .rotation-setting input {\n        height: 26px;\n      }\n\n      .ratio-value {\n        font-size: 12px;\n      }\n\n      .align-select {\n        .dropdown-button, .dropdown-button:hover {\n          height: 26px;\n        }\n      }\n    "])))},e.prototype.render=function(){var t,e,o,n,i=this,a=this.props,s=a.layoutId,f=a.layoutItem,I=a.isLockLayout;if(!f)return null;var v=f.setting||{},x=v.style||{},S=f.bbox||{},M=(null===(t=v.autoProps)||void 0===t?void 0:t.width)!==p.LayoutItemSizeModes.Custom,b=null!==(o=null===(e=v.autoProps)||void 0===e?void 0:e.height)&&void 0!==o?o:p.LayoutItemSizeModes.Custom,w="ratio"===v.heightMode;return r.jsx("div",{className:"column-item-setting",css:this.getStyle()},!I&&r.jsx(r.React.Fragment,null,r.jsx(u.SettingSection,{title:this.formatMessage("size")},r.jsx(u.SettingRow,{label:this.formatMessage("width")},r.jsx("div",{style:g},r.jsx(h.SizeEditor,{label:"W",mode:M?p.LayoutItemSizeModes.Stretch:p.LayoutItemSizeModes.Custom,sizeModes:[p.LayoutItemSizeModes.Custom,p.LayoutItemSizeModes.Stretch],value:null==S?void 0:S.width,availableUnits:y,onChange:function(t){return i.updateBBox("width",t)},onModeChange:this.updateWidthMode}))),r.jsx(u.SettingRow,{label:this.formatMessage("height")},r.jsx("div",{style:g},r.jsx(h.SizeEditor,{label:"H",mode:b||p.LayoutItemSizeModes.Custom,sizeModes:c,value:S.height,availableUnits:m,onChange:function(t){return i.updateBBox("height",t)},onModeChange:this.updateHeightMode,disabled:w}))),b===p.LayoutItemSizeModes.Custom&&r.jsx(u.SettingRow,null,r.jsx(l.Checkbox,{checked:w,onChange:function(t){return i.updateAspectSetting(t.target.checked?"ratio":"fixed")},className:"mr-2"}),this.formatMessage("keepAspectRatio")),w&&r.jsx(u.SettingRow,{label:this.formatMessage("aspectRatio")},r.jsx(h.InputRatio,{value:v.aspectRatio,style:g,onChange:this.updateAspectRatio})),!M&&r.jsx(u.SettingRow,{label:this.formatMessage("align")},r.jsx(l.Select,{className:"align-select",value:null!==(n=x.alignSelf)&&void 0!==n?n:"flex-start",onChange:this.updateAlignSelf,style:g},r.jsx("option",{value:"flex-start"},this.formatMessage("start")),r.jsx("option",{value:"flex-end"},this.formatMessage("end")),r.jsx("option",{value:"center"},this.formatMessage("center")))),r.jsx(d.CommonTransformSetting,{layoutId:s,layoutItemId:f.id,setting:v,onSettingChange:this.props.onSettingChange,formatMessage:this.props.formatMessage}))),(f.widgetId||f.sectionId)&&r.jsx(d.CommonLayoutItemSetting,{layoutId:s,layoutItemId:f.id,isSection:f.type===r.LayoutItemType.Section,style:this.props.style,onStyleChange:this.props.onStyleChange,onSettingChange:this.props.onSettingChange,formatMessage:this.props.formatMessage}))},e}(r.React.PureComponent);e.default=f},7:function(t,e){t.exports=i},8:function(t,e){t.exports=a}})}));